<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<style type="text/css">@media screen { h1,h2,h3,h4,h5,p,a,br,li,td, .underline {font-family:Arial, Helvetica, sans-serif;text-align:justify} body {font-size:11pt;line-height:1.3em} h1 {font-size:18pt} h2 {font-size:15pt} h3 {font-size:13pt} h4 {font-size:12pt} h5 {font-size:11pt} hr {text-align:center;height:1px;border:none;background:black} ol,ul,p,table {margin-left:3em;margin-right:3em} a {text-decoration:none} a:hover {text-decoration:underline} img {} .defword {width:25%} .defexplain {} .defexplain p {padding:0em;margin:0em} .deftablepara {} .deftable {width:85%;padding-left:1em;border-style:none;vertical-align:top} .deftable td {text-align:left;vertical-align:top} .deftablefaq {border-style:solid;border-width:thin} .stdtable {border:1px solid;background:black} .stdtable th {padding:0.5em;background:#EEEEEE;font-family:Arial, Helvetica, sans-serif;font-weight:bold;text-align:center} .stdtable td {padding:0.5em;background:white;text-align:left;vertical-align:top} .end {font-size:8pt} .example {margin-left:3em;margin-right:3em;border:1px solid;padding:1em;background-color:#EEEEEE} .header {margin-left:3em;margin-right:3em;border:1px solid;padding:1em;background-color:#FFFFEE} .indented {margin-left: 50px} .litable {text-align:left} .new {border-right:10px solid;padding-right:10px;font-family:Arial} .note {margin:0.5em 3em 0.5em 3em;border:1px solid;padding:0em;background-color:#F0F0A0} .note .title {font-family:sans-serif;font-weight:bold;margin:0.5em} .note .message {margin:0.5em 1.5em 0.5em 1.5em;padding:0em} .note .message p {padding:0em;margin:1em 0em 1em 0em} .reference {} .caption {font-size:10pt;text-align:center;font-style:italic} .todolist {padding:0.5em;font-size:10pt} .todolist p {margin:0em 3em 0em 3em} .todo {margin:1em 3em 1em 3em;padding:0.5em;border:solid 2px black;background:#FFAAAA;font-size:8pt} .todo p {margin:0.2em 1em 0.2em 1em} .inline {margin:0.5em 3em 0.5em 3em;border:solid 1px;padding:0em;background-color:#EEEEEE} .inline .title {font-family:sans-serif;font-weight:bold;margin:0.5em} .inline .elements {font-size:10pt;margin:0em 0em 0.5em 0em;padding:0em 1em 0em 1em} .inline .elements p {display:inline-table;margin:0.25em 0.5em 0.25em 0.5em} .tocindent {margin-left: 2em} .top {font-size:8pt;text-align:right} .underline {text-decoration:underline} } @media print { h1,h2,h3,h4,h5,p,a,br,li, #underline {font-family:Arial;text-align:justify;orphans:5;widows:5} p,li,td {font-size:10pt} ul,ol {page-break-after:avoid;orphans:5;widows:5} }</style><title>R3 GUI Actor/Reactor design changes</title></head><body onload="window.location.hash = window.location.hash"><a id="top" name="top"></a><h2>R3 GUI Actor/Reactor design changes</h2><pre class="example">Author: Richard Smolak
Date: 20-Jan-2013</pre><hr /><h2>Contents</h2><div class="tocindent"><a href="#sect1"><strong>1. Introduction</strong></a><br /><a href="#sect2"><strong>2. No more Reactors</strong></a><br /><a href="#sect3"><strong>3. Actor Overriding</strong></a><br /><a href="#sect4"><strong>4. ON-ACTION actor</strong></a><br /><a href="#sect5"><strong>5. Face ATTACH mechanism</strong></a><br /><a href="#sect6"><strong>6. API function changes</strong></a><br /></div><h2><a id="sect1" name="sect1">1. Introduction</a></h2><p>This document describes the changes related to the decision to simplify the current actor/reactor model.</p><div class="top">[ <a href="#top">back to top</a> ]</div><hr /><h2><a id="sect2" name="sect2">2. No more Reactors</a></h2><p>The Reactors have been completely removed from the system because we (the RMA team) agreed they make the usage of the framework confusing and not flexible enough.</p><p>After the changes made to the R3GUI the programmer will need to deal only with Actors.</p><div class="top">[ <a href="#top">back to top</a> ]</div><hr /><h2><a id="sect3" name="sect3">3. Actor Overriding</a></h2><p>Here is an example how to override a style (default) actor of a face:</p><pre class="example">view [
    my-field: field on-key [
        ;arg holds event object
        if arg/type = 'key [
            print [&quot;field&quot; face/name &quot;key:&quot; mold arg/key]
        ]
    ]
]</pre><p>Running the above code you should see that the w:on-key actor has been overridden in the w:my-field face and the new code is executed instead.</p><p>But now the typed characters aren't shown in the field. That's because the style w:on-key actor is not called anymore.</p><p>Here is a modified code of the above example executing the style actor after the newly added code:</p><pre class="example">view [
    my-field: field on-key [
        ;arg holds event object
        if arg/type = 'key [
            print [&quot;field&quot; face/name &quot;key:&quot; mold arg/key]
        ]

        ;now call the FIELD style actor
        do-actor/style face 'on-key arg face/style
    ]
]</pre><p>This techinque is flexible enough so the programmer can call the style actor at any possible place in the new code that overrides the style actor.</p><div class="note"><div class="message"><p>NOTES:</p><p>1. Should we introduce API function wrapper for calling the style actor in some easier way?</p><p>2. If yes, what syntax form and name should have such function wrapper?</p></div></div><div class="top">[ <a href="#top">back to top</a> ]</div><hr /><h2><a id="sect4" name="sect4">4. ON-ACTION actor</a></h2><p>Because the DO reactor doesn't exist in the system, the ON-ACTION actor has been added as 'system actor' for the default style terminal action.</p><p>The ON-ACTION actor is useful if the style needs to call some default action from multiple places (actors) in the style definition.</p><p>For example, the BUTTON style needs to call the default style action from the ON-KEY actor and also from the ON-CLICK actor, so it is better to call the ON-ACTION actor from the both code points to avoid the necessity to override multiple style actors.</p><p>The ON-ACTION actor can be overridden in the layout block without the need to call the original style actor code. Here is an example:</p><pre class="example">view [
    button on-action [print &quot;button pressed&quot;]
]</pre><div class="note"><div class="message"><p>NOTES:</p><p>Styles should not define the ON-ACTION actor. This way the layout programmer doesn't need to deal with any interferences.</p><p>Do we need a better name for this actor?</p></div></div><div class="top">[ <a href="#top">back to top</a> ]</div><hr /><h2><a id="sect5" name="sect5">5. Face ATTACH mechanism</a></h2><p>The face attaching subsystem has been reworked. The ATTACH reactor doesn't exist. The ATTACH keyword has been added to the layout dialect to keep the current syntax.</p><p>Summary of main changes in the subsystem:</p><ul><li>the face/targets field contains faces that are attached FROM the face</li><li>the face/attached field contains faces that are attached TO the face</li><li>the ON-ATTACH actor is called in the target face during the time the target face is being attached from any source face. The ON-ATTACH actor is optional.</li></ul><p>for example:</p><pre class="example">view [
    t1: toggle &quot;toggle 1&quot; attach 't2
    t2: toggle &quot;toggle 2&quot;
    t3: toggle &quot;toggle 3&quot; attach 't1
]</pre><p>In the example above:</p><div class="deftablepara"><table class="deftable"><tr><td class="defword"><strong>t1/targets</strong></td><td class="defexplain"><p>contains t2</p></td></tr></table></div><div class="deftablepara"><table class="deftable"><tr><td class="defword"><strong>t1/attached</strong></td><td class="defexplain"><p>contains t3</p></td></tr></table></div><div class="deftablepara"><table class="deftable"><tr><td class="defword"><strong>t2/attached</strong></td><td class="defexplain"><p>contains t1</p></td></tr></table></div><div class="deftablepara"><table class="deftable"><tr><td class="defword"><strong>t3/targets</strong></td><td class="defexplain"><p>contains t1</p></td></tr></table></div><ul><li>the attached actions are chained by default (if the default ON-ATTACHED actor is used). So if we use the example above:</li></ul><div class="deftablepara"><table class="deftable"><tr><td class="defword"><strong>pressing t1</strong></td><td class="defexplain"><p>triggers t2 only</p></td></tr></table></div><div class="deftablepara"><table class="deftable"><tr><td class="defword"><strong>pressing t2</strong></td><td class="defexplain"><p>no effect</p></td></tr></table></div><div class="deftablepara"><table class="deftable"><tr><td class="defword"><strong>pressing t3</strong></td><td class="defexplain"><p>triggers t1 but since t1 is attached to t2, t2 is triggered as well</p></td></tr></table></div><ul><li>if any triggered face attaches back to the initial face in the chain, such a feedback attachment is skipped and ignored</li><li>the ON-ATTACHED actor is called in every face that is triggered in the attach reaction chain.</li></ul><p>If the ON-ATTACHED actor returns TRUE the reaction is chained. Otherwise the reaction is terminated in such face.</p><p>The default ON-ATTACHED actor contains following code:</p><pre class="example">on-attached: [  ;arg: dst-face no-show-flag
    apply :set-face [arg/1 get-face face arg/2]
    true
]</pre><p>Where the ARG is the source face that triggers the actual face.</p><div class="note"><div class="message"><p>NOTES:</p><p>1. Are the face/targets, face/attached and other naming good enough or are there better names?</p><p>2. Any feedback to the chaining is appreciated.</p><p>3.</p></div></div><div class="top">[ <a href="#top">back to top</a> ]</div><hr /><h2><a id="sect6" name="sect6">6. API function changes</a></h2><p>Following table describes all API functions that have been changed, added or removed:</p><div><table class="stdtable" border="0" cellpadding="0" cellspacing="1"><tr><td>Function name </td><td>state </td><td>Description </td></tr><tr><td>DO-FACE </td><td>changed </td><td>Function name has been reused for the changed behaviour. Now the function executes the standard action code sequence of a face.The sequence contains the code that tries to call all attached targets of the face and then the ON-ACTION terminal actor (see below) </td></tr><tr><td>DO-STYLE </td><td>renamed to DO-ACTOR </td><td>DO-ACTOR now tries to call the face (overriding) actor first. If the face actor is not defined it calls style actor. DO-ACTOR/STYLE calls only the specified style actor code. It can be used to mix different actor calls. </td></tr><tr><td>DO-TARGETS </td><td>added </td><td>This function calls DO-FACE function on all target faces (the faces that have been attached FROM the calling face). Use DO-TARGETS/CUSTOM to execute custom code instead of the DO-FACE call on every target face. </td></tr><tr><td>DO-ATTACHED </td><td>changed </td><td>This function calls DO-FACE function on all faces which are attached TO the calling face. Use DO-ATTACHED/CUSTOM to execute custom code before the DO-FACE call on every attached face.</td></tr></table></div><div class="note"><div class="message"><p>Should be any function name changed to better one?</p></div></div><div class="top">[ <a href="#top">back to top</a> ]</div><hr /><p class="end">Document formatter copyright <a href="http://www.robertmuench.de">Robert M. M&uuml;nch</a>. All Rights Reserved.<br />XHTML 1.0 Transitional formatted with Make-Doc-Pro Version:1.3.0 on 20-Jan-2013 at 18:13:53</p></body></html>